name: Build and Deploy
on:
  push:
    branches:
      - data
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout site-gen ðŸ›Žï¸
        uses: actions/checkout@v2.3.1
        with:
          persist-credentials: false
          token: ${{ secrets.GH_PAT }} # `GH_PAT` is a secret that contains your PAT
          repository: v2hot/v2hot-site-gen

      - name: Checkout data ðŸ›Žï¸
        uses: actions/checkout@v2.3.1
        with:
          persist-credentials: false
          ref: data # Branch
          path: data # Directory

      - name: Install and Build ðŸ”§
        run: |
          yarn install
          echo "STATIC_PATH=https://cdn.jsdelivr.net/gh/v2hot/v2hot.github.io@${{ secrets.STATIC_VERSION }}/static" > .env
          node lib/index.js
          cp data/.github/firebase/.firebaserc ./
          cp data/.github/firebase/firebase.json ./

      - name: Deploy ðŸš€
        uses: JamesIves/github-pages-deploy-action@4.1.5
        with:
          branch: gh-pages # The branch the action should deploy to.
          folder: public # The folder the action should deploy.
          single-commit: true

      - name: Deploy ðŸš€
        uses: JamesIves/github-pages-deploy-action@4.1.5
        with:
          branch: gh-pages # The branch the action should deploy to.
          folder: public # The folder the action should deploy.
          single-commit: true
          repository-name: PipecraftNet/v2hot.github.io
          token: ${{ secrets.GH_PAT }} # `GH_PAT` is a secret that contains your PAT

      - name: Deploy to Firebase ðŸš€
        uses: FirebaseExtended/action-hosting-deploy@v0 # https://github.com/FirebaseExtended/action-hosting-deploy
        with:
          repoToken: "${{ secrets.GITHUB_TOKEN }}"
          firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT_V2EX_HOT }}"
          channelId: live
